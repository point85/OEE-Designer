-- HSQLDB schema creation script file, schema version 5
-- set to your schema
SET AUTOCOMMIT TRUE;

/****** Plant Entity table ******/
DROP TABLE PLANT_ENTITY IF EXISTS;

CREATE CACHED TABLE PLANT_ENTITY (
	ENT_KEY bigint GENERATED BY DEFAULT AS IDENTITY,
	VERSION int NULL,
	NAME nvarchar(64) NULL,
	DESCRIPTION nvarchar(256) NULL,
	PARENT_KEY bigint NULL,
	HIER_LEVEL nvarchar(16) NULL,
	RETENTION bigint NULL,
    PRIMARY KEY (ENT_KEY)
);

/****** Reason table ******/
DROP TABLE REASON IF EXISTS;

CREATE CACHED TABLE REASON (
	REASON_KEY bigint GENERATED BY DEFAULT AS IDENTITY,
	VERSION int NULL,
	NAME nvarchar(64) NULL,
	DESCRIPTION nvarchar(128) NULL,
	PARENT_KEY bigint NULL,
	LOSS nvarchar(32) NULL,
    PRIMARY KEY (REASON_KEY)
);

/****** Material table ******/
DROP TABLE MATERIAL IF EXISTS;

CREATE CACHED TABLE MATERIAL (
	MAT_KEY bigint GENERATED BY DEFAULT AS IDENTITY,
	VERSION int NULL,
	NAME nvarchar(64) NULL,
	DESCRIPTION nvarchar(128) NULL,
	CATEGORY nvarchar(32) NULL,
    PRIMARY KEY (MAT_KEY)
);

/****** Equipment Material table ******/
DROP TABLE EQUIPMENT_MATERIAL IF EXISTS;

CREATE CACHED TABLE EQUIPMENT_MATERIAL (
	EM_KEY bigint GENERATED BY DEFAULT AS IDENTITY,
	MAT_KEY bigint NULL,
	EQ_KEY bigint NULL,
	OEE_TARGET numeric NULL,
	RUN_AMOUNT numeric NULL,
	RUN_UOM_KEY bigint NULL,
	REJECT_UOM_KEY bigint NULL,
	IS_DEFAULT smallint NOT NULL,
    PRIMARY KEY (EM_KEY)
);

/****** Data Source table ******/
DROP TABLE DATA_SOURCE IF EXISTS;

CREATE CACHED TABLE DATA_SOURCE (
	SOURCE_KEY bigint GENERATED BY DEFAULT AS IDENTITY,
	VERSION int NOT NULL,
	NAME nvarchar(64) NOT NULL,
	DESCRIPTION nvarchar(128) NULL,
	TYPE nvarchar(16) NOT NULL,
	HOST nvarchar(128) NULL,
	USER_NAME nvarchar(64) NULL,
	PASSWORD nvarchar(64) NULL,
	PORT int NULL,
	END_PATH nvarchar(128) NULL,
	SEC_POLICY nvarchar(64) NULL,
	MSG_MODE nvarchar(64) NULL,
	KEYSTORE nvarchar(128) NULL,
	KEYSTORE_PWD nvarchar(64) NULL,
	PRIMARY KEY (SOURCE_KEY)
);

/****** Event Resolver table ******/ 
DROP TABLE EVENT_RESOLVER IF EXISTS;

CREATE CACHED TABLE EVENT_RESOLVER (
	ER_KEY bigint GENERATED BY DEFAULT AS IDENTITY,
	ENT_KEY bigint NULL,
	SOURCE_ID nvarchar(128) NULL,
	SCRIPT nvarchar(4000) NULL,
	SOURCE_KEY bigint NULL,
	PERIOD int NULL,
	ER_TYPE nvarchar(16) NULL,
	DATA_TYPE nvarchar(32) NULL,
	COLLECT_KEY bigint NULL,
	PRIMARY KEY (ER_KEY)
);

/****** Unit of Measure table ******/
DROP TABLE UOM IF EXISTS; 

CREATE CACHED TABLE UOM (
	UOM_KEY bigint GENERATED BY DEFAULT AS IDENTITY,
	VERSION int NOT NULL,
	NAME nvarchar(64) NULL,
	SYMBOL nvarchar(16) NOT NULL,
	DESCRIPTION nvarchar(512) NULL,
	CATEGORY nvarchar(64) NULL,
	UNIT_TYPE nvarchar(32) NULL,
	UNIT nvarchar(32) NULL,
	CONV_FACTOR float NULL,
	CONV_UOM_KEY bigint NULL,
	CONV_OFFSET float NULL,
	BRIDGE_FACTOR float NULL,
	BRIDGE_UOM_KEY bigint NULL,
	BRIDGE_OFFSET float NULL,
	UOM1_KEY bigint NULL,
	EXP1 int NULL,
	UOM2_KEY bigint NULL,
	EXP2 int NULL,
	PRIMARY KEY (UOM_KEY)
);

/****** WORK_SCHEDULE table ******/
DROP TABLE WORK_SCHEDULE IF EXISTS;

CREATE CACHED TABLE WORK_SCHEDULE (
	WS_KEY bigint GENERATED BY DEFAULT AS IDENTITY,
	VERSION int NULL,
	NAME nvarchar(64) NULL,
	DESCRIPTION nvarchar(512) NULL,
	PRIMARY KEY (WS_KEY)
);

/****** SHIFT table ******/
DROP TABLE SHIFT IF EXISTS;

CREATE CACHED TABLE SHIFT (
	SHIFT_KEY bigint GENERATED BY DEFAULT AS IDENTITY,
	NAME nvarchar(64) NULL,
	DESCRIPTION nvarchar(128) NULL,
	START_TIME time(3) NULL,
	DURATION bigint NULL,
	WS_KEY bigint NULL,
	PRIMARY KEY (SHIFT_KEY)
);

/****** TEAM table ******/
DROP TABLE TEAM IF EXISTS;

CREATE CACHED TABLE TEAM (
	TEAM_KEY bigint GENERATED BY DEFAULT AS IDENTITY,
	NAME nvarchar(64) NULL,
	DESCRIPTION nvarchar(128) NULL,
	WS_KEY bigint NULL,
	ROTATION_KEY bigint NULL,
	ROTATION_START date NULL,
	PRIMARY KEY (TEAM_KEY)
);

/****** ROTATION table ******/
DROP TABLE ROTATION IF EXISTS;

CREATE CACHED TABLE ROTATION (
	ROTATION_KEY bigint GENERATED BY DEFAULT AS IDENTITY,
	NAME nvarchar(64) NULL,
	DESCRIPTION nvarchar(128) NULL,
	WS_KEY bigint NULL,
	PRIMARY KEY (ROTATION_KEY)
);

/****** ROTATION_SEGMENT table ******/
DROP TABLE ROTATION_SEGMENT IF EXISTS;

CREATE CACHED TABLE ROTATION_SEGMENT (
	SEGMENT_KEY bigint GENERATED BY DEFAULT AS IDENTITY,
	ROTATION_KEY bigint NULL,
	SEQUENCE smallint NULL,
	SHIFT_KEY bigint NULL,
	DAYS_ON smallint NULL,
	DAYS_OFF smallint NULL,
	PRIMARY KEY (SEGMENT_KEY)
);

/****** NON_WORKING_PERIOD table ******/
DROP TABLE NON_WORKING_PERIOD IF EXISTS;

CREATE CACHED TABLE NON_WORKING_PERIOD (
	PERIOD_KEY bigint GENERATED BY DEFAULT AS IDENTITY,
	NAME nvarchar(64) NULL,
	DESCRIPTION nvarchar(128) NULL,
	START_DATE_TIME datetime(3) NULL,
	DURATION bigint NULL,
	WS_KEY bigint NULL,
	LOSS nvarchar(32) NULL,
	PRIMARY KEY (PERIOD_KEY)
);

/****** BREAK_PERIOD table ******/
DROP TABLE BREAK_PERIOD IF EXISTS;

CREATE CACHED TABLE BREAK_PERIOD (
	BREAK_KEY bigint GENERATED BY DEFAULT AS IDENTITY,
	NAME nvarchar(64) NULL,
	DESCRIPTION nvarchar(128) NULL,
	START_TIME time(3) NULL,
	DURATION bigint NULL,
	SHIFT_KEY bigint NULL,
	LOSS nvarchar(32) NULL,
	PRIMARY KEY (BREAK_KEY)
);

/****** COLLECTOR table ******/
DROP TABLE COLLECTOR IF EXISTS;

CREATE CACHED TABLE COLLECTOR (
	COLLECT_KEY bigint GENERATED BY DEFAULT AS IDENTITY,
	VERSION int NULL,
	NAME nvarchar(64) NULL,
	DESCRIPTION nvarchar(128) NULL,
	STATE nvarchar(16) NULL,
	HOST nvarchar(64) NULL,
	BROKER_HOST nvarchar(64) NULL,
	BROKER_PORT int NULL,
	BROKER_USER nvarchar(64) NULL,
	BROKER_PWD nvarchar(64) NULL,
	BROKER_TYPE nvarchar(16) NULL,
	SOURCE_KEY bigint NULL,
	PRIMARY KEY (COLLECT_KEY)
);

/****** OEE_EVENT table ******/
DROP TABLE OEE_EVENT IF EXISTS;

CREATE CACHED TABLE OEE_EVENT (
	EVENT_KEY bigint GENERATED BY DEFAULT AS IDENTITY,
	ENT_KEY bigint NOT NULL,
	START_TIME datetime(3) NOT NULL,
	START_TIME_OFFSET int NOT NULL,
	END_TIME datetime(3) NULL,
	END_TIME_OFFSET int NULL,
	SHIFT_KEY bigint NULL,
	TEAM_KEY bigint NULL,
	REASON_KEY bigint NULL,
	DURATION bigint NULL,
	EVENT_TYPE nvarchar(16) NOT NULL,
	AMOUNT numeric NULL,
	UOM_KEY bigint NULL,
	MATL_KEY bigint NULL,
	JOB nvarchar(64) NULL,
	IN_VALUE nvarchar(64) NULL,
	SOURCE_ID nvarchar(64) NULL,
	COLLECTOR nvarchar(64) NULL,
	PRIMARY KEY (EVENT_KEY)
);

/****** Plant Entity Work Schedule table ******/
DROP TABLE ENTITY_SCHEDULE IF EXISTS;

CREATE CACHED TABLE ENTITY_SCHEDULE (
	ES_KEY bigint GENERATED BY DEFAULT AS IDENTITY,
	ENT_KEY bigint NULL,
	WS_KEY bigint NULL,
	START_DATE_TIME datetime(3) NULL,
	END_DATE_TIME datetime(3) NULL,
    PRIMARY KEY (ES_KEY)
);



